<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Rabbish&#39;s Blog</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2023-05-18T05:50:24.127Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>Rabbish</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Hello World</title>
    <link href="http://example.com/2023/05/18/hello-world/"/>
    <id>http://example.com/2023/05/18/hello-world/</id>
    <published>2023-05-18T05:50:24.127Z</published>
    <updated>2023-05-18T05:50:24.127Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Gateway网关</title>
    <link href="http://example.com/2023/05/18/%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3gateway/"/>
    <id>http://example.com/2023/05/18/%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3gateway/</id>
    <published>2023-05-17T16:00:00.000Z</published>
    <updated>2023-05-17T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<!-- ---title: Gateway网关date:updated:tags:categories:keywords:description:top_img:comments:cover:toc:toc_number:toc_style_simple:copyright:copyright_author:copyright_author_href:copyright_url:copyright_info:mathjax:katex:aplayer:highlight_shrink:aside:abcjs:--- --><p><a href="https://spring.io/projects/spring-cloud-gateway">https://spring.io/projects/spring-cloud-gateway</a><img src="https://cdn.nlark.com/yuque/0/2023/png/29150499/1683787209762-4a1efe4d-d51b-4f76-a020-89312e69ba97.png#averageHue=%23f9f6f6&clientId=u3ff20f2d-934b-4&from=paste&height=790&id=u7517fae2&originHeight=790&originWidth=1575&originalType=binary&ratio=1&rotation=0&showTitle=false&size=316773&status=done&style=none&taskId=uac68bca6-59ae-4b95-8acf-ec1730803d6&title=&width=1575" alt="image.png"></p><h1 id="搭建网关服务"><a href="#搭建网关服务" class="headerlink" title="搭建网关服务"></a>搭建网关服务</h1><p><img src="https://cdn.nlark.com/yuque/0/2023/png/29150499/1683789152581-9edce70b-661b-484b-b49b-3fd5a9ac07b6.png#averageHue=%23f5f5f5&clientId=u3ff20f2d-934b-4&from=paste&height=726&id=u6532c098&originHeight=726&originWidth=882&originalType=binary&ratio=1&rotation=0&showTitle=false&size=137288&status=done&style=none&taskId=uc2d9283d-11ce-43d7-8ff2-cb0e1d6d92e&title=&width=882" alt="image.png"></p><h2 id="1、新建网关模块，引入springcloudgateway依赖和nacos的服务发现依赖"><a href="#1、新建网关模块，引入springcloudgateway依赖和nacos的服务发现依赖" class="headerlink" title="1、新建网关模块，引入springcloudgateway依赖和nacos的服务发现依赖"></a>1、新建网关模块，引入springcloudgateway依赖和nacos的服务发现依赖</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h2 id="2、编写spring启动类"><a href="#2、编写spring启动类" class="headerlink" title="2、编写spring启动类"></a>2、编写spring启动类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GatewayApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(GatewayApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3、编写路由配置和nacos地址"><a href="#3、编写路由配置和nacos地址" class="headerlink" title="3、编写路由配置和nacos地址"></a>3、编写路由配置和nacos地址</h2><p>新建application.yml文件，配置端口号、网关服务的名称，nacos地址，网关路由等信息</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8888</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span> <span class="comment"># 服务名称</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacos注册中心地址</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> <span class="comment"># 路由id，自定义，必须唯一</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://userservice</span> <span class="comment"># 路由的目标地址，lb是负载均衡，后边是服务名称</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># 路由断言，也就是判断请求是否符合路由规则的条件</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span> <span class="comment"># 安装路径匹配</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">order-service</span> <span class="comment"># 路由id，自定义，必须唯一</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://orderservice</span> <span class="comment"># 路由的目标地址，lb是负载均衡，后边是服务名称</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># 路由断言，也就是判断请求是否符合路由规则的条件</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/order/**</span> <span class="comment"># 安装路径匹配</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4、启动gateway服务，通过8888端口访问"><a href="#4、启动gateway服务，通过8888端口访问" class="headerlink" title="4、启动gateway服务，通过8888端口访问"></a>4、启动gateway服务，通过8888端口访问</h2><p>网关会根据url的规则自动路由到orde服务<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29150499/1683788925635-5ced4149-84dc-4de3-849d-3df72ec05cb0.png#averageHue=%23e0b580&clientId=u3ff20f2d-934b-4&from=paste&height=596&id=ub2e64a37&originHeight=596&originWidth=947&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32549&status=done&style=none&taskId=u38504108-7d2b-4cdc-8b22-f4867be204c&title=&width=947" alt="image.png"></p><h2 id="访问流程"><a href="#访问流程" class="headerlink" title="访问流程"></a>访问流程</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/29150499/1683789113999-b55469c0-98b1-4c93-9192-bdf3694455ce.png#averageHue=%23f8f1f1&clientId=u3ff20f2d-934b-4&from=paste&height=708&id=uf54489c3&originHeight=708&originWidth=1502&originalType=binary&ratio=1&rotation=0&showTitle=false&size=199856&status=done&style=none&taskId=u0b9e02c6-effe-4b2c-bad0-15235075a90&title=&width=1502" alt="image.png"></p><h1 id="路由断言工厂"><a href="#路由断言工厂" class="headerlink" title="路由断言工厂"></a>路由断言工厂</h1><p><img src="https://cdn.nlark.com/yuque/0/2023/png/29150499/1683789203051-b5ee1909-eb27-40de-9e1b-1c08b9f19c14.png#averageHue=%23f6f5f5&clientId=u3ff20f2d-934b-4&from=paste&height=451&id=uffd2d871&originHeight=451&originWidth=1123&originalType=binary&ratio=1&rotation=0&showTitle=false&size=141806&status=done&style=none&taskId=u20ebd906-6f64-4b93-97c3-051cb1083b5&title=&width=1123" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29150499/1683789848480-b3a41657-32d5-458e-9339-ffde6f1d2604.png#averageHue=%23f2f2f2&clientId=u3ff20f2d-934b-4&from=paste&height=339&id=u9ef6c81c&originHeight=339&originWidth=1526&originalType=binary&ratio=1&rotation=0&showTitle=false&size=117005&status=done&style=none&taskId=u8873b132-edec-4840-8d43-38e6c6874fb&title=&width=1526" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29150499/1683789861106-72d8f1d6-c7e7-4312-a26e-c331a9652186.png#averageHue=%23d1c9c8&clientId=u3ff20f2d-934b-4&from=paste&height=697&id=ue674743c&originHeight=697&originWidth=1463&originalType=binary&ratio=1&rotation=0&showTitle=false&size=302453&status=done&style=none&taskId=ue0883251-b3f6-4b58-89a4-0e197c91dd2&title=&width=1463" alt="image.png"></p><h1 id="spring路由过滤器GatewayFilter"><a href="#spring路由过滤器GatewayFilter" class="headerlink" title="spring路由过滤器GatewayFilter"></a>spring路由过滤器GatewayFilter</h1><p><strong>GatewayFilter是网关中提供的一种过滤器，可以对进入网关的请求和微服务返回的响应做处理：</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29150499/1683790271124-0bf6cc48-5070-444d-861f-381c65e46ccd.png#averageHue=%23fbfaf8&clientId=u3ff20f2d-934b-4&from=paste&height=583&id=ue94fd01a&originHeight=583&originWidth=1576&originalType=binary&ratio=1&rotation=0&showTitle=false&size=197252&status=done&style=none&taskId=u61167844-a815-468c-8372-35831341e7b&title=&width=1576" alt="image.png"></p><h2 id="spring过滤器工厂GatewayFilterFactory"><a href="#spring过滤器工厂GatewayFilterFactory" class="headerlink" title="spring过滤器工厂GatewayFilterFactory"></a>spring过滤器工厂GatewayFilterFactory</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/29150499/1683790424746-b2b7171f-6686-48fe-98b2-a62c88564ad8.png#averageHue=%23dacdcc&clientId=u3ff20f2d-934b-4&from=paste&height=698&id=ud1cf3b15&originHeight=698&originWidth=1574&originalType=binary&ratio=1&rotation=0&showTitle=false&size=159944&status=done&style=none&taskId=ueaa9d687-9920-425d-a8df-429a22319a6&title=&width=1574" alt="image.png"></p><h2 id="gatewayfilter使用"><a href="#gatewayfilter使用" class="headerlink" title="gatewayfilter使用"></a>gatewayfilter使用</h2><p>为所有访问userservice的请求添加一个请求头，Truth&#x3D;itcast<br>方法：</p><h3 id="1、在gateway服务的application-yml中配置"><a href="#1、在gateway服务的application-yml中配置" class="headerlink" title="1、在gateway服务的application.yml中配置"></a>1、在gateway服务的application.yml中配置</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8888</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span> <span class="comment"># 服务名称</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacos注册中心地址</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> <span class="comment"># 路由id，自定义，必须唯一</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://userservice</span> <span class="comment"># 路由的目标地址，lb是负载均衡，后边是服务名称</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># 路由断言，也就是判断请求是否符合路由规则的条件</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span> <span class="comment"># 安装路径匹配</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">AddRequestHeader=Truth,itcast</span> <span class="comment"># 前面是键，后面的值，k-v键值对</span></span><br></pre></td></tr></table></figure><h3 id="2、在userservice服务中获取请求头"><a href="#2、在userservice服务中获取请求头" class="headerlink" title="2、在userservice服务中获取请求头"></a>2、在userservice服务中获取请求头</h3><p>在controller层的代码中作如下修改，使用@RequestHeader注解获取请求头，并打印</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">queryById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id,<span class="meta">@RequestHeader</span> String truth)</span> &#123;</span><br><span class="line">    System.out.println(truth);</span><br><span class="line">    <span class="keyword">return</span> userService.queryById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3、成功打印出来，说明成功添加了请求头"><a href="#3、成功打印出来，说明成功添加了请求头" class="headerlink" title="3、成功打印出来，说明成功添加了请求头"></a>3、成功打印出来，说明成功添加了请求头</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/29150499/1683790919103-f5213bee-9cbc-48f0-8aaa-ae9e09bd88e6.png#averageHue=%23e9f5fb&clientId=u3ff20f2d-934b-4&from=paste&height=178&id=ua21fdeb9&originHeight=178&originWidth=1664&originalType=binary&ratio=1&rotation=0&showTitle=false&size=80587&status=done&style=none&taskId=ueae72536-1531-41e4-84fd-48deb1138e7&title=&width=1664" alt="image.png"></p><h2 id="default-filters-默认过滤器"><a href="#default-filters-默认过滤器" class="headerlink" title="default-filters 默认过滤器"></a>default-filters 默认过滤器</h2><p><strong>如果想要对所有的请求都生效，则可以将过滤器工厂写到default下，格式如下：</strong><br><strong>default-filters与routers同级</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8888</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span> <span class="comment"># 服务名称</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacos注册中心地址</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> <span class="comment"># 路由id，自定义，必须唯一</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://userservice</span> <span class="comment"># 路由的目标地址，lb是负载均衡，后边是服务名称</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># 路由断言，也就是判断请求是否符合路由规则的条件</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span> <span class="comment"># 安装路径匹配</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">order-service</span> <span class="comment"># 路由id，自定义，必须唯一</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://orderservice</span> <span class="comment"># 路由的目标地址，lb是负载均衡，后边是服务名称</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># 路由断言，也就是判断请求是否符合路由规则的条件</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/order/**</span> <span class="comment"># 安装路径匹配</span></span><br><span class="line">      <span class="attr">default-filters:</span> </span><br><span class="line">        <span class="bullet">-</span> <span class="string">AddRequestHeader=Truth,ITCAST</span></span><br></pre></td></tr></table></figure><h2 id="全局过滤器-GlobleFilter"><a href="#全局过滤器-GlobleFilter" class="headerlink" title="全局过滤器 GlobleFilter"></a>全局过滤器 GlobleFilter</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/29150499/1683792093694-edcd808a-f90a-4064-947d-8cb5ec8af267.png#averageHue=%23ecf2e7&clientId=u3ff20f2d-934b-4&from=paste&height=692&id=uec7e112c&originHeight=692&originWidth=1548&originalType=binary&ratio=1&rotation=0&showTitle=false&size=318615&status=done&style=none&taskId=ufa86742e-39f9-489e-ad21-3f5afc9cb7e&title=&width=1548" alt="image.png"></p><h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/29150499/1683792214703-b3ac847c-4efd-4844-9c25-a6c81281e692.png#averageHue=%23f5f4f3&clientId=u3ff20f2d-934b-4&from=paste&height=365&id=ufa021b9b&originHeight=365&originWidth=1217&originalType=binary&ratio=1&rotation=0&showTitle=false&size=187436&status=done&style=none&taskId=u787d9228-3cbf-43a1-9a81-63023817055&title=&width=1217" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.gateway.filter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GatewayFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.reactive.ServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.MultiValueMap;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.server.ServerWebExchange;</span><br><span class="line"><span class="keyword">import</span> reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Order(-1)</span> <span class="comment">//用于定义过滤器顺序，里面存放一个int整数，数值越小，该过滤器的优先级越高</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//注入到Spring中，作为一个Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorizationFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="comment">//1.获取请求参数</span></span><br><span class="line">        <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">        MultiValueMap&lt;String, String&gt; queryParams = request.getQueryParams();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.获取参数中的authorize参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">authorization</span> <span class="operator">=</span> queryParams.getFirst(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.判断参数值是否等于admin</span></span><br><span class="line">        <span class="keyword">if</span> (authorization.equals(<span class="string">&quot;admin&quot;</span>))&#123;</span><br><span class="line">            <span class="comment">//4.是，放行</span></span><br><span class="line">            Mono&lt;Void&gt; mono = chain.filter(exchange);<span class="comment">//从过滤器链中找到下一个过滤器，进入下一个过滤器，放行</span></span><br><span class="line">            <span class="keyword">return</span> mono;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.不是，拦截</span></span><br><span class="line">        <span class="comment">//5.1 设置响应状态码</span></span><br><span class="line">        exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);</span><br><span class="line">        <span class="comment">//5.2 拦截请求</span></span><br><span class="line">        <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/29150499/1683793327327-148c80b5-34d6-42de-8021-377f4b4b0491.png#averageHue=%23eeeeee&clientId=u3ff20f2d-934b-4&from=paste&height=365&id=u0fe05389&originHeight=365&originWidth=796&originalType=binary&ratio=1&rotation=0&showTitle=false&size=83572&status=done&style=none&taskId=u57d65fe6-00c8-45b7-8047-6f7c18681b1&title=&width=796" alt="image.png"></p><h1 id="过滤器执行顺序"><a href="#过滤器执行顺序" class="headerlink" title="过滤器执行顺序"></a>过滤器执行顺序</h1><p><img src="https://cdn.nlark.com/yuque/0/2023/png/29150499/1683794514081-64290010-73ce-4bed-82cc-dc9776ce7772.png#averageHue=%23c3bebc&clientId=u3ff20f2d-934b-4&from=paste&height=744&id=u37b65e09&originHeight=744&originWidth=1548&originalType=binary&ratio=1&rotation=0&showTitle=false&size=319435&status=done&style=none&taskId=u6f2e5380-c08e-4c0f-a434-9a2bec9e006&title=&width=1548" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29150499/1683794794085-1c02e9de-07fe-40d7-8a7e-42da259dfc41.png#averageHue=%23f2f0f0&clientId=u3ff20f2d-934b-4&from=paste&height=662&id=uc80ffa3a&originHeight=662&originWidth=1558&originalType=binary&ratio=1&rotation=0&showTitle=false&size=352195&status=done&style=none&taskId=uf691bf6f-0b2f-441d-9fae-5fa482b9553&title=&width=1558" alt="image.png"></p><h1 id="网关跨域问题"><a href="#网关跨域问题" class="headerlink" title="网关跨域问题"></a>网关跨域问题</h1><p><strong>有了网关之后，只需在网关服务进行处理，而不需要对每个微服务都进行处理</strong><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29150499/1683795014295-a7d796f8-f1d8-447c-aa1c-1253d08b766c.png#averageHue=%23f2f2f2&clientId=u3ff20f2d-934b-4&from=paste&height=415&id=ufa044452&originHeight=415&originWidth=1273&originalType=binary&ratio=1&rotation=0&showTitle=false&size=147212&status=done&style=none&taskId=u79a1a1e8-4f15-43ce-a2b2-c2425d7a0dc&title=&width=1273" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29150499/1683795126633-4c2ca350-2a15-4e16-958a-9cac208fe719.png#averageHue=%23eef4e9&clientId=u3ff20f2d-934b-4&from=paste&height=688&id=u9184a42f&originHeight=688&originWidth=1219&originalType=binary&ratio=1&rotation=0&showTitle=false&size=353083&status=done&style=none&taskId=uc7184c2d-cbc2-4b10-99bd-23827ed3598&title=&width=1219" alt="image.png"></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8888</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span> <span class="comment"># 服务名称</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacos注册中心地址</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">globalcors:</span> <span class="comment"># 全局的跨域处理</span></span><br><span class="line">        <span class="attr">add-to-simple-url-handler-mapping:</span> <span class="literal">true</span> <span class="comment"># gateway默认拦截option请求，设置为true后可以解决options请求被拦截的问题</span></span><br><span class="line">        <span class="attr">cors-configurations:</span></span><br><span class="line">          <span class="string">&#x27;[/**]&#x27;</span><span class="string">:</span> <span class="comment"># 表示拦截所有请求</span></span><br><span class="line">            <span class="attr">allowedOrigins:</span> <span class="comment"># 允许哪些网站的跨域请求</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;http://localhost:8090&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;http://www.leyou.com&quot;</span></span><br><span class="line">            <span class="attr">allowedMethods:</span> <span class="comment"># 允许跨域的ajax请求方式</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;GET&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;POST&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;DELETE&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;PUT&quot;</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">&quot;OPTIONS&quot;</span></span><br><span class="line">            <span class="attr">allowedHeaders:</span> <span class="string">&quot;*&quot;</span> <span class="comment"># 允许在请求中携带的头信息</span></span><br><span class="line">            <span class="attr">allowCredentials:</span> <span class="literal">true</span> <span class="comment"># 是否允许携带cookie</span></span><br><span class="line">            <span class="attr">maxAge:</span> <span class="number">360000</span> <span class="comment"># 本次跨域检测的有效期</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/29150499/1683795857246-3a928738-4b11-4e44-8451-1ad6cefb860b.png#averageHue=%23f2f2f2&clientId=u3ff20f2d-934b-4&from=paste&height=458&id=ue206fb8a&originHeight=458&originWidth=623&originalType=binary&ratio=1&rotation=0&showTitle=false&size=69593&status=done&style=none&taskId=u54a2d098-e028-456e-9d8c-47ed3a8ae68&title=&width=623" alt="image.png"></p>]]></content>
    
    
    <summary type="html">gateway网关配置入门</summary>
    
    
    
    
  </entry>
  
</feed>
